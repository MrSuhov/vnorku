# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ —Å Order-service

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
**–§–∞–π–ª**: `services/order-service/order_optimizer_handler.py`
- `handle_analysis_complete(order_id)` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä
- `format_optimization_results()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ª–æ–≥–æ–≤

### 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ Order-service
**–§–∞–π–ª**: `services/order-service/main.py`
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `process_analysis_complete_orders()` –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
- –ü–æ—Å–ª–µ —Å—Ç–∞—Ç—É—Å–∞ `ANALYSIS_COMPLETE` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `OPTIMIZED`

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `FAILED`
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `order.error_details`

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **RPA-service** –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤–æ –≤—Å–µ—Ö –õ–°–î
2. **Order-service** –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å `ANALYSIS_COMPLETE`
3. **–§–æ–Ω–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤ Order-service (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫) –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑—ã –≤ `ANALYSIS_COMPLETE`
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É –¥–ª—è –≤—Å–µ—Ö –∫–æ—Ä–∑–∏–Ω
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø-10 –ª—É—á—à–∏—Ö
   - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–ø-10 –≤ –ë–î
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã** –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram
6. **–°—Ç–∞—Ç—É—Å** –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `OPTIMIZED`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–∞
```bash
cd /Users/ss/GenAI/korzinka
python3 run_order_optimization.py 16
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å Order-service
```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Order-service –∑–∞–ø—É—â–µ–Ω
cd /Users/ss/GenAI/korzinka
./start_services.sh

# 2. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ ANALYSIS_COMPLETE –≤—Ä—É—á–Ω—É—é:
psql postgresql://korzinka_user:korzinka_pass@localhost:5432/korzinka -c "UPDATE orders SET status = 'analysis_complete' WHERE id = 16"

# 3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Order-service - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ ~10 —Å–µ–∫
tail -f logs/order-service.log
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î
```bash
# –°–º–æ—Ç—Ä–∏–º —Ç–æ–ø-10 –∫–æ—Ä–∑–∏–Ω
psql postgresql://korzinka_user:korzinka_pass@localhost:5432/korzinka -c "SELECT basket_id, total_loss_and_delivery, total_cost FROM basket_analyses WHERE order_id = 16 ORDER BY total_loss_and_delivery LIMIT 10"

# –°–º–æ—Ç—Ä–∏–º —Ç–æ–≤–∞—Ä—ã –≤ –ª—É—á—à–µ–π –∫–æ—Ä–∑–∏–Ω–µ
psql postgresql://korzinka_user:korzinka_pass@localhost:5432/korzinka -c "SELECT basket_id, product_name, lsd_name, price FROM basket_combinations WHERE order_id = 16 AND basket_id = 1"
```

## –ß—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î

### –¢–æ–ª—å–∫–æ —Ç–æ–ø-10 –ª—É—á—à–∏—Ö –∫–æ—Ä–∑–∏–Ω:

1. **basket_combinations** - —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ç–æ–ø-10 –∫–æ—Ä–∑–∏–Ω (~60 —Å—Ç—Ä–æ–∫ –¥–ª—è 6 —Ç–æ–≤–∞—Ä–æ–≤)
2. **basket_delivery_costs** - —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ç–æ–ø-10 (~20-30 —Å—Ç—Ä–æ–∫)
3. **basket_analyses** - –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Ç–æ–ø-10 (10 —Å—Ç—Ä–æ–∫)

## –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–π**: ~0.04 —Å–µ–∫ (–¥–ª—è 472k –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
- **–ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∫–æ—Ä–∑–∏–Ω**: ~10-20 —Å–µ–∫
- **–ó–∞–ø–∏—Å—å —Ç–æ–ø-10 –≤ –ë–î**: ~0.5 —Å–µ–∫
- **–ò–¢–û–ì–û**: ~15-25 —Å–µ–∫ –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –õ–æ–≥–∏

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö Order-service –ø–æ—è–≤–∏—Ç—Å—è:
```
üéØ Running optimizer for order 16...
‚úÖ Order 16 optimized successfully:
   ‚Ä¢ Analyzed: 472,392 combinations
   ‚Ä¢ Saved: top-10 baskets
   ‚Ä¢ Best basket: #1
   ‚Ä¢ Best cost: 1234.56‚ÇΩ
   ‚Ä¢ Loss + Delivery: 123.45‚ÇΩ
   ‚Ä¢ Time: 15.67s
‚úÖ Order 16 status updated to OPTIMIZED
```

## Troubleshooting

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Order-service –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: `SELECT status FROM orders WHERE id = 16`
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `analysis_complete`

### –û—à–∏–±–∫–∞ DATABASE_URL
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `DATABASE_URL` –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ fprice_optimizer
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `SELECT COUNT(*) FROM fprice_optimizer WHERE order_id = 16`

### –î–æ–ª–≥–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
- 472k –∫–æ–º–±–∏–Ω–∞—Ü–∏–π = ~15-20 —Å–µ–∫
