# –î–æ—Ä–∞–±–æ—Ç–∫–∏ PDF-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –æ—Ç 07.10.2025 (v3)

## –î–∞—Ç–∞: 07.10.2025

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–≤–µ –≤–∞–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –†–∞–∑–¥–µ–ª–∞ 2 (–ú–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã):

1. **–ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞ –Ω–æ–≤–æ–º –ª–∏—Å—Ç–µ**
2. **–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è**

---

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: –ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞ –Ω–æ–≤–æ–º –ª–∏—Å—Ç–µ

### –ë—ã–ª–æ:
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã –¥–æ–±–∞–≤–ª—è–ª—Å—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è), –≤—Å–µ –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã —à–ª–∏ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

### –°—Ç–∞–ª–æ:
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `PageBreak()` - –∫–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞.

### –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

**–§–∞–π–ª:** `/Users/ss/GenAI/korzinka/services/order-service/pdf_generator.py`

**–ë—ã–ª–æ:**
```python
# –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –∫–æ—Ä–∑–∏–Ω–∞–º–∏
if idx < len(data):
    story.append(Spacer(1, 0.5*cm))
    story.append(Paragraph("‚îÄ" * 80, self.body_style))
    story.append(Spacer(1, 0.5*cm))
```

**–°—Ç–∞–ª–æ:**
```python
# –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –∫–æ—Ä–∑–∏–Ω–∞–º–∏ - –ù–û–í–´–ô –õ–ò–°–¢
if idx < len(data):
    story.append(PageBreak())  # –ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞ –Ω–æ–≤–æ–º –ª–∏—Å—Ç–µ
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ —Ç–µ–ø–µ—Ä—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ª–∏—Å—Ç–µ
‚úÖ –£–¥–æ–±–Ω–µ–µ –ø–µ—á–∞—Ç–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å
‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –õ–°–î

---

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞:
- –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `delivery_cost_model` –Ω–µ None
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ (–æ–∂–∏–¥–∞–ª—Å—è —Ñ–æ—Ä–º–∞—Ç —Å `thresholds` –∏ `fees`, –∞ –≤ –ë–î —Ñ–æ—Ä–º–∞—Ç —Å `delivery_cost`)

### –†–µ—à–µ–Ω–∏–µ:

#### 2.1. –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if delivery_cost_model:`

**–ë—ã–ª–æ:**
```python
delivery_cost_model = basket.get('delivery_cost_model')
if delivery_cost_model:  # ‚ùå –£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ —Å–ª—É—á–∞–∏ —Å –ø—É—Å—Ç—ã–º model
    story.append(Spacer(1, 0.3*cm))
    delivery_info = self._parse_delivery_model(delivery_cost_model)
    ...
```

**–°—Ç–∞–ª–æ:**
```python
# –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
story.append(Spacer(1, 0.3*cm))
delivery_cost_model = basket.get('delivery_cost_model')
delivery_info = self._parse_delivery_model(delivery_cost_model)
story.append(Paragraph("<b>–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:</b>", self.bold_style))
...
```

#### 2.2. –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_parse_delivery_model`

**–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–æ–∂–∏–¥–∞–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):**
```json
{
  "thresholds": [0, 1000, 2000],
  "fees": [149, 99, 0]
}
```

**–†–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –ë–î:**
```json
{
  "delivery_cost": [
    {"min": 0, "max": 1000, "fee": 149, "label": "Def1"},
    {"min": 1000, "max": 2000, "fee": 99, "label": "Def2"},
    {"min": 2000, "max": null, "fee": 0, "label": "Def3"}
  ]
}
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
1. –ú–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç `delivery_cost` –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª—è `min`, `max`, `fee` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Å –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü–µ–π –∏ –±–µ–∑
4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. –í–º–µ—Å—Ç–æ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É

### –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞:

#### –ü—Ä–∏–º–µ—Ä 1: –°–∞–º–æ–∫–∞—Ç
```
–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: 0.00 —Ä—É–±
‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏:
  - –û—Ç 0.00 –¥–æ 300.00 —Ä—É–±: 300.00 —Ä—É–±
  - –û—Ç 300.00 —Ä—É–±: –±–µ—Å–ø–ª–∞—Ç–Ω–æ
```

#### –ü—Ä–∏–º–µ—Ä 2: –Ø–Ω–¥–µ–∫—Å –õ–∞–≤–∫–∞
```
–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: 0.00 —Ä—É–±
‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏:
  - –û—Ç 0.00 –¥–æ 1150.00 —Ä—É–±: 134.00 —Ä—É–±
  - –û—Ç 1150.00 –¥–æ 1950.00 —Ä—É–±: 94.00 —Ä—É–±
  - –û—Ç 1950.00 —Ä—É–±: –±–µ—Å–ø–ª–∞—Ç–Ω–æ
```

#### –ü—Ä–∏–º–µ—Ä 3: –í–∫—É—Å–í–∏–ª–ª (–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞)
```
–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: 0.00 —Ä—É–±
‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏:
  - –û—Ç 0.00 —Ä—É–±: –±–µ—Å–ø–ª–∞—Ç–Ω–æ
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ delivery_cost_model –≤ –ë–î:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `delivery_cost` | array | –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ |
| `delivery_cost[].min` | number | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ |
| `delivery_cost[].max` | number\|null | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ (null = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è) |
| `delivery_cost[].fee` | number | –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ |
| `delivery_cost[].label` | string | –ú–µ—Ç–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (Def1, Def2, –∏ —Ç.–¥.) |

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞:

1. –ò—â–µ–º –ø–µ—Ä–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –≥–¥–µ `fee > 0`
2. –ë–µ—Ä–µ–º –µ–≥–æ `min` –∫–∞–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –∑–∞–∫–∞–∑–∞
3. –ï—Å–ª–∏ –≤—Å–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Å `fee = 0`, –±–µ—Ä–µ–º `min` –ø–µ—Ä–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å order-service**
2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑**
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å PDF - –†–∞–∑–¥–µ–ª 2:**

**–î–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

‚úÖ **–û—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç:**
- [ ] –ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞
- [ ] –ù–µ—Ç –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã—Ö –õ–°–î –Ω–∞ –æ–¥–Ω–æ–º –ª–∏—Å—Ç–µ

‚úÖ **–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:**
- [ ] –ë–ª–æ–∫ "–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç **–¥–ª—è –∫–∞–∂–¥–æ–π** –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω—ã
- [ ] –ü–æ–∫–∞–∑–∞–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- [ ] –ü–æ–∫–∞–∑–∞–Ω—ã –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏
- [ ] –ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã PDF:

```
[–õ–∏—Å—Ç 1] –†–∞–∑–¥–µ–ª 0: –õ—É—á—à–∞—è –∫–æ—Ä–∑–∏–Ω–∞
[–õ–∏—Å—Ç 2] –†–∞–∑–¥–µ–ª 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã
[–õ–∏—Å—Ç 3] –†–∞–∑–¥–µ–ª 2.1: –°–∞–º–æ–∫–∞—Ç
         + –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
         + –ò—Ç–æ–≥–∏
         + –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ ‚úÖ
[–õ–∏—Å—Ç 4] –†–∞–∑–¥–µ–ª 2.2: –Ø–Ω–¥–µ–∫—Å –õ–∞–≤–∫–∞
         + –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
         + –ò—Ç–æ–≥–∏
         + –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ ‚úÖ
[–õ–∏—Å—Ç 5] –†–∞–∑–¥–µ–ª 2.3: –í–∫—É—Å–í–∏–ª–ª
         + –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
         + –ò—Ç–æ–≥–∏
         + –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ ‚úÖ
...
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ SQL:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å delivery_cost_model –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –õ–°–î
SELECT 
    name,
    display_name,
    delivery_cost_model
FROM lsd_configs
WHERE is_active = true;
```

---

## –ò—Ç–æ–≥

‚úÖ **–ö–∞–∂–¥–∞—è –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞ –Ω–æ–≤–æ–º –ª–∏—Å—Ç–µ**
‚úÖ **–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è**
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ delivery_cost_model**
‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–≠—Ç–æ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑:
- `PDF_FIXES_2025-10-07-v2.md` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `PDF_FIX_MONO_BASKETS.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–æ–∫–æ—Ä–∑–∏–Ω
- `PDF_FIX_LOSS_CALCULATION.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ—Ç–µ—Ä—å

–¢–µ–ø–µ—Ä—å PDF –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
