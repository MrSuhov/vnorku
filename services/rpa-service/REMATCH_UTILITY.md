# Rematch Utility - –£—Ç–∏–ª–∏—Ç–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ match_score

## –û–ø–∏—Å–∞–Ω–∏–µ

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ `match_score` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å—è—Ö —Ç–∞–±–ª–∏—Ü—ã `lsd_stocks` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ v5.2.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–∞—Å—á–µ—Ç–∞ match_score
- –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–æ–≤–∞—Ä–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–£—Ç–∏–ª–∏—Ç–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/Users/ss/GenAI/korzinka/services/rpa-service/rematch_stocks.py` –∏ —É–∂–µ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–µ–∫—É—â–∏–º match_score

```bash
cd /Users/ss/GenAI/korzinka/services/rpa-service
python3 rematch_stocks.py --stats
```

**–í—ã–≤–æ–¥:**
```
================================================================================
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê MATCH_SCORE
================================================================================

–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: 150
–°—Ä–µ–¥–Ω–∏–π score: 0.723
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π: 0.250
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π: 1.000

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º:
  0.0-0.3: 5 (3.3%)
  0.3-0.5: 12 (8.0%)
  0.5-0.7: 45 (30.0%)
  0.7-0.9: 67 (44.7%)
  0.9-1.0: 21 (14.0%)
```

### 2. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ (DRY RUN - –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)

```bash
python3 rematch_stocks.py --dry-run
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Å–¥–µ–ª–∞–Ω—ã, –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—è –∏—Ö –≤ –ë–î. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º.

### 3. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î)

```bash
python3 rematch_stocks.py
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–∑–º–µ–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î!

### 4. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

```bash
python3 rematch_stocks.py --order-id 123
```

–ü–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç match_score —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø–∏—Å–µ–π –∑–∞–∫–∞–∑–∞ #123.

### 5. –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ (verbose)

```bash
python3 rematch_stocks.py --verbose
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
- –ö–∞–∫–∏–µ —Å–ª–æ–≤–∞ –Ω–∞–π–¥–µ–Ω—ã
- –ö–∞–∫–∏–µ —à—Ç—Ä–∞—Ñ—ã –∏ –±–æ–Ω—É—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- –§–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ score

### 6. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏

```bash
# Dry run + verbose –¥–ª—è –∑–∞–∫–∞–∑–∞ #123
python3 rematch_stocks.py --order-id 123 --dry-run --verbose

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–∫–∞–∑—É #123
python3 rematch_stocks.py --order-id 123 --stats
```

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –°—É—Ö–æ–π –ø—Ä–æ–≥–æ–Ω (dry-run)

```
================================================================================
üîÑ REMATCH UTILITY v5.2 - –ü–µ—Ä–µ—Å—á–µ—Ç match_score –¥–ª—è lsd_stocks
================================================================================
üß™ DRY RUN MODE - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ù–ï –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î

üì¶ –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 150

[10/150] –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ...
[20/150] –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ...
...

================================================================================
üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
================================================================================
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 150
–û–±–Ω–æ–≤–ª–µ–Ω–æ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ score): 45
–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: 105
–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (|Œî| > 0.1): 8

üîç –¢–û–ü-10 –ó–ù–ê–ß–ò–¢–ï–õ–¨–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô:

ID 234:
  '–ª–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞—è —Ä—É—Å—Å–∫–æ–µ –º–æ—Ä–µ' vs '–°–µ–ª—å–¥—å –≤ –º–∞—Å–ª–µ –ê-–ª—è –ª–æ—Å–æ—Å—å –†—É—Å—Å–∫–æ–µ –º–æ—Ä–µ'
  0.850 ‚Üí 0.575 (-0.275)

ID 456:
  '—á–µ—Ä–∫–∏–∑–æ–≤–æ —Å–∞–ª—å—á–∏—á–æ–Ω' vs '–ö–æ–ª–±–∞—Å–∞ —Å—ã—Ä–æ–∫–æ–ø—á–µ–Ω–∞—è –°–∞–ª—å—á–∏—á–æ–Ω –ß–µ—Ä–∫–∏–∑–æ–≤–æ'
  0.900 ‚Üí 0.850 (-0.050)

...

================================================================================
‚úÖ Rematch completed successfully!
================================================================================
```

### Verbose —Ä–µ–∂–∏–º

```
üìù –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
  ID: 234
  –ó–∞–ø—Ä–æ—Å: '–ª–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞—è —Ä—É—Å—Å–∫–æ–µ –º–æ—Ä–µ'
  –ù–∞–π–¥–µ–Ω–æ: '–°–µ–ª—å–¥—å –≤ –º–∞—Å–ª–µ –ê-–ª—è –ª–æ—Å–æ—Å—å –†—É—Å—Å–∫–æ–µ –º–æ—Ä–µ 240 –≥'
  Search words: ['–ª–æ—Å–æ—Å—å', '—Å–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞—è', '—Ä—É—Å—Å–∫–æ–µ', '–º–æ—Ä–µ']
  Found words: ['—Å–µ–ª—å–¥—å', '–º–∞—Å–ª–µ', '–ª–æ—Å–æ—Å—å', '—Ä—É—Å—Å–∫–æ–µ', '–º–æ—Ä–µ', '240']
  ‚ö†Ô∏è First word at pos 3 with low coverage (-0.25)
  ‚úÖ Exact ratio bonus: +0.08
  üìä base=0.750 + bonus=0.075 - penalty=0.250 = 0.575
  –ë—ã–ª–æ: 0.850 ‚Üí –°—Ç–∞–ª–æ: 0.575 (Œî -0.275)
```

## –§–ª–∞–≥–∏

| –§–ª–∞–≥ | –ö–æ—Ä–æ—Ç–∫–∏–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| `--stats` | - | –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É match_score –±–µ–∑ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ |
| `--order-id N` | - | –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑ —Å ID=N |
| `--dry-run` | - | –ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î |
| `--verbose` | `-v` | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Ä–∞—Å—á–µ—Ç–∞ |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run` —Å–Ω–∞—á–∞–ª–∞** —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è
2. **–°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î** –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ–¥–Ω–æ–º –∑–∞–∫–∞–∑–µ** —Å `--order-id` –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º

## –ü—Ä–∏–º–µ—Ä—ã workflow

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
python3 rematch_stocks.py --stats

# 2. –°–¥–µ–ª–∞—Ç—å dry-run —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
python3 rematch_stocks.py --dry-run

# 3. –ï—Å–ª–∏ –≤—Å–µ –û–ö - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
python3 rematch_stocks.py

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
python3 rematch_stocks.py --stats
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

```bash
# 1. –ü–æ–¥—Ä–æ–±–Ω—ã–π dry-run –¥–ª—è –∑–∞–∫–∞–∑–∞
python3 rematch_stocks.py --order-id 123 --dry-run --verbose

# 2. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑
python3 rematch_stocks.py --order-id 123
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞

```bash
# 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –∑–∞–∫–∞–∑–∞–º
python3 rematch_stocks.py --stats

# 2. –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
python3 rematch_stocks.py --dry-run --verbose > rematch_analysis.log

# 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥ —Ñ–∞–π–ª
grep "–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ" rematch_analysis.log
```

## –ê–ª–≥–æ—Ä–∏—Ç–º v5.2

–£—Ç–∏–ª–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º —á—Ç–æ –∏ production –∫–æ–¥:
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞ (-0.25 –¥–æ -0.45)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã —Å —É—á–µ—Ç–æ–º –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤
- –°–º—è–≥—á–µ–Ω–∏–µ —à—Ç—Ä–∞—Ñ–æ–≤ –∫–æ–≥–¥–∞ –í–°–ï —Å–ª–æ–≤–∞ –Ω–∞–π–¥–µ–Ω—ã (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `MATCH_SCORE_v52_UPDATE.md`

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `lsd_stocks` JOIN `order_items`
- **–ü–æ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** `match_score`, `is_exact_match`
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~100 –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫

## Troubleshooting

### –û—à–∏–±–∫–∞: "No module named 'shared'"

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd /Users/ss/GenAI/korzinka/services/rpa-service
python3 rematch_stocks.py
```

### –û—à–∏–±–∫–∞: "Database connection failed"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
cd /Users/ss/GenAI/korzinka
./start_services.sh
```

### –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TOP-10 –∏–∑–º–µ–Ω–µ–Ω–∏–π - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏—á–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —è–≤–Ω–æ —Ä–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –Ω–∏–∑–∫–∏–π score).

## –°–º. —Ç–∞–∫–∂–µ

- `MATCH_SCORE_v52_UPDATE.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- `main.py` - production –∫–æ–¥ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `calculate_advanced_match_score()`
