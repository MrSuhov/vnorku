# Match Score Algorithm Update v5.6

## –î–∞—Ç–∞: 4 –æ–∫—Ç—è–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º–∞ –≤ v5.5

**–ö–µ–π—Å:** "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã 6 —Å–æ—Ç–æ–∫ 680 –≥"
- **–¢–µ–∫—É—â–∏–π match_score v5.5:** ~0.9 (—Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ)
- **–û–∂–∏–¥–∞–µ–º—ã–π match_score:** < 0.7 (—à—Ç—Ä–∞—Ñ –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç "–æ–≥—É—Ä—Ü—ã")

**–ü—Ä–∏—á–∏–Ω–∞:** –ê–ª–≥–æ—Ä–∏—Ç–º v5.5 –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª –Ω–∞–ª–∏—á–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –Ω–∞–π–¥–µ–Ω–Ω–æ–º —Ç–æ–≤–∞—Ä–µ.

---

## –†–µ—à–µ–Ω–∏–µ v5.6

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–°–ª–æ–≤–∞—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
   - –î–æ–±–∞–≤–ª–µ–Ω `PRODUCT_CATEGORIES` —Å 8 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏: –æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã, —è–≥–æ–¥—ã, –º–æ–ª–æ—á–Ω—ã–µ, –º—è—Å–æ, —Ä—ã–±–∞, –∫—Ä—É–ø—ã, –∑–µ–ª–µ–Ω—å
   - –ö–∞–∂–¥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ª–µ–º–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ

2. **–°–ª–æ–≤–∞—Ä—å —á–∞—Å—Ç–µ–π/–ø–æ–¥–≤–∏–¥–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤**
   - –î–æ–±–∞–≤–ª–µ–Ω `PRODUCT_PARTS` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
   - –ü—Ä–∏–º–µ—Ä: "–∫—É—Ä–∏—Ü–∞" ‚Üí "–≥—Ä—É–¥–∫–∞" (—á–∞—Å—Ç—å), "–ø–æ–º–∏–¥–æ—Ä" ‚Üí "—á–µ—Ä—Ä–∏" (–ø–æ–¥–≤–∏–¥)

3. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ `get_product_category(product_name)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

4. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ `detect_extra_products_same_category(search_query, found_name)`
   - –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ search_query
   - –ò—Å–∫–ª—é—á–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã (–ø–æ–º–∏–¥–æ—Ä == —Ç–æ–º–∞—Ç)
   - –ò—Å–∫–ª—é—á–∞–µ—Ç —á–∞—Å—Ç–∏/–ø–æ–¥–≤–∏–¥—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞

5. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–∞**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ `calculate_extra_products_penalty(extra_products)`
   - 1 –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç: -0.30
   - 2+ –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç–∞: -0.45

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `calculate_advanced_match_score()`**
   - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ numeric_penalty
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥: "v5.5" ‚Üí "v5.6", –¥–æ–±–∞–≤–ª–µ–Ω extra_products_penalty

---

## –õ–æ–≥–∏–∫–∞ —à—Ç—Ä–∞—Ñ–æ–≤

| –°–∏—Ç—É–∞—Ü–∏—è | –ü—Ä–∏–º–µ—Ä | –®—Ç—Ä–∞—Ñ | –£—Ä–æ–≤–µ–Ω—å |
|----------|--------|-------|---------|
| 1 –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç | "—á–µ—Ä—Ä–∏" vs "—á–µ—Ä—Ä–∏ –æ–≥—É—Ä—Ü—ã" | -0.30 | –°—Ä–µ–¥–Ω–∏–π |
| 2+ –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç–∞ | "—á–µ—Ä—Ä–∏" vs "—á–µ—Ä—Ä–∏ –æ–≥—É—Ä—Ü—ã –ø–µ—Ä–µ—Ü" | -0.45 | –ö—Ä–∏—Ç–∏—á–Ω—ã–π |

**–ù–ï —à—Ç—Ä–∞—Ñ—É–µ–º:**
- –ü—Ä–æ–¥—É–∫—Ç—ã —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π ("—è–±–ª–æ–∫–∏" vs "—è–±–ª–æ–∫–∏ —Ç–æ–º–∞—Ç–Ω—ã–µ")
- –ß–∞—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ ("–∫—É—Ä–∏—Ü–∞" vs "–∫—É—Ä–∏—Ü–∞ –≥—Ä—É–¥–∫–∞")
- –ü–æ–¥–≤–∏–¥—ã ("–ø–æ–º–∏–¥–æ—Ä" vs "–ø–æ–º–∏–¥–æ—Ä—ã —á–µ—Ä—Ä–∏")
- –°–∏–Ω–æ–Ω–∏–º—ã ("–ø–æ–º–∏–¥–æ—Ä" vs "—Ç–æ–º–∞—Ç—ã")
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ ("–æ–≥—É—Ä—Ü—ã" vs "–æ–≥—É—Ä—Ü—ã —Å–≤–µ–∂–∏–µ")

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –û–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ–≤–æ—â (–û–°–ù–û–í–ù–û–ô –ö–ï–ô–°)

**–ó–∞–ø—Ä–æ—Å:** "—á–µ—Ä—Ä–∏"  
**–ù–∞–π–¥–µ–Ω–æ:** "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã 6 —Å–æ—Ç–æ–∫ 680 –≥"

```
üîç Determining category: '—á–µ—Ä—Ä–∏' -> –∫–∞—Ç–µ–≥–æ—Ä–∏—è: –æ–≤–æ—â–∏
üîç Found products in category: ['–ø–æ–º–∏–¥–æ—Ä', '—á–µ—Ä—Ä–∏', '–æ–≥—É—Ä–µ—Ü']
üîç Search products: ['—á–µ—Ä—Ä–∏']
üîç Extra products before filtering: ['–ø–æ–º–∏–¥–æ—Ä', '–æ–≥—É—Ä–µ—Ü']
üîç Filtering: '–ø–æ–º–∏–¥–æ—Ä' is parent of '—á–µ—Ä—Ä–∏' - excluded
üîç Filtering: '–æ–≥—É—Ä–µ—Ü' is unrelated - kept
‚ùå Extra products in same category (–æ–≤–æ—â–∏): ['–æ–≥—É—Ä–µ—Ü'] (penalty: -0.30)
‚ö†Ô∏è Full coverage bonus blocked due to extra products in same category
üìä Score breakdown v5.6: base=1.000, bonus=0.00, penalty=0.65 (extra_products=0.30), final=0.350
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.35 < 0.7 ‚úÖ

### –ü—Ä–∏–º–µ—Ä 2: –î–≤–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–≤–æ—â–∞

**–ó–∞–ø—Ä–æ—Å:** "–ø–æ–º–∏–¥–æ—Ä—ã"  
**–ù–∞–π–¥–µ–Ω–æ:** "–ü–æ–º–∏–¥–æ—Ä—ã –æ–≥—É—Ä—Ü—ã –ø–µ—Ä–µ—Ü –º–∏–∫—Å"

```
‚ùå Extra products in same category (–æ–≤–æ—â–∏): ['–æ–≥—É—Ä–µ—Ü', '–ø–µ—Ä–µ—Ü'] (penalty: -0.45)
üìä Score breakdown v5.6: base=1.000, penalty=0.65 (extra_products=0.45), final=0.550
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.55 ‚úÖ

### –ü—Ä–∏–º–µ—Ä 3: –†–∞–∑–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ù–ï —à—Ç—Ä–∞—Ñ—É–µ–º)

**–ó–∞–ø—Ä–æ—Å:** "—è–±–ª–æ–∫–∏"  
**–ù–∞–π–¥–µ–Ω–æ:** "–Ø–±–ª–æ–∫–∏ —Ç–æ–º–∞—Ç–Ω—ã–µ"

```
üîç Category: —Ñ—Ä—É–∫—Ç—ã
üîç Found products in category: [] (—Ç–æ–º–∞—Ç - –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–≤–æ—â–∏)
üìä Score breakdown v5.6: base=1.000, penalty=0.00 (extra_products=0.00), final=1.000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1.00 (–±–µ–∑ —à—Ç—Ä–∞—Ñ–∞) ‚úÖ

### –ü—Ä–∏–º–µ—Ä 4: –ß–∞—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞ (–ù–ï —à—Ç—Ä–∞—Ñ—É–µ–º)

**–ó–∞–ø—Ä–æ—Å:** "–∫—É—Ä–∏—Ü–∞"  
**–ù–∞–π–¥–µ–Ω–æ:** "–ö—É—Ä–∏—Ü–∞ –≥—Ä—É–¥–∫–∞"

```
üîç Extra products before filtering: ['–≥—Ä—É–¥–∫–∞']
üîç Filtering: '–≥—Ä—É–¥–∫–∞' is part of '–∫—É—Ä–∏—Ü–∞' - excluded
üìä Score breakdown v5.6: base=1.000, penalty=0.00 (extra_products=0.00), final=1.000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1.00 (–±–µ–∑ —à—Ç—Ä–∞—Ñ–∞) ‚úÖ

### –ü—Ä–∏–º–µ—Ä 5: –ü–æ–¥–≤–∏–¥ (–ù–ï —à—Ç—Ä–∞—Ñ—É–µ–º)

**–ó–∞–ø—Ä–æ—Å:** "–ø–æ–º–∏–¥–æ—Ä—ã"  
**–ù–∞–π–¥–µ–Ω–æ:** "–ü–æ–º–∏–¥–æ—Ä—ã —á–µ—Ä—Ä–∏ –∫—Ä–∞—Å–Ω—ã–µ"

```
üîç Extra products before filtering: ['—á–µ—Ä—Ä–∏']
üîç Filtering: '—á–µ—Ä—Ä–∏' is subtype of '–ø–æ–º–∏–¥–æ—Ä' - excluded
üìä Score breakdown v5.6: base=1.000, penalty=0.00 (extra_products=0.00), final=1.000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1.00 (–±–µ–∑ —à—Ç—Ä–∞—Ñ–∞) ‚úÖ

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ —à—Ç—Ä–∞—Ñ–æ–≤ v5.6

```
total_penalty = 
    length_penalty (–¥–æ -0.30) +
    first_word_penalty (–¥–æ -0.45) +
    processing_penalty (–¥–æ -0.50) +
    extra_products_penalty (–¥–æ -0.45) [–ù–û–í–û–ï v5.6] +
    numeric_penalty (–¥–æ -0.60)
```

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —à—Ç—Ä–∞—Ñ:** -2.30 (–æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ final_score = 0.0)

---

## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ v5.6

–ë–æ–Ω—É—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤ —á–µ—Ç—ã—Ä–µ—Ö —Å–ª—É—á–∞—è—Ö:
1. `penalty >= 0.5` (–º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º)
2. `has_unrequested_processing` (–Ω–µ–∑–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
3. `critical_numeric_mismatch` (numeric_penalty >= 0.35)
4. **`has_extra_products`** (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) - **–ù–û–í–û–ï v5.6**

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **`/Users/ss/GenAI/korzinka/shared/utils/text_processing.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω `PRODUCT_CATEGORIES` - —Å–ª–æ–≤–∞—Ä—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –î–æ–±–∞–≤–ª–µ–Ω `PRODUCT_PARTS` - —Å–ª–æ–≤–∞—Ä—å —á–∞—Å—Ç–µ–π/–ø–æ–¥–≤–∏–¥–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_product_category()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `detect_extra_products_same_category()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_extra_products_penalty()`

2. **`/Users/ss/GenAI/korzinka/services/rpa-service/main.py`**
   - –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `calculate_advanced_match_score()`:
     - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
     - –†–∞—Å—á–µ—Ç extra_products_penalty
     - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ has_extra_products
   - –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥: "v5.5" ‚Üí "v5.6"

3. **`/Users/ss/GenAI/korzinka/test_match_score_v56.py`** (–ù–û–í–´–ô)
   - –¢–µ—Å—Ç—ã —Å–ª–æ–≤–∞—Ä–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –¢–µ—Å—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –¢–µ—Å—Ç—ã –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –¢–µ—Å—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–æ–≤
   - –¢–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ **–¢–µ—Å—Ç 1:** –°–ª–æ–≤–∞—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (8/8)
- –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ

‚úÖ **–¢–µ—Å—Ç 2:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ (8/8)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤

‚úÖ **–¢–µ—Å—Ç 3:** –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (7/8)
- ‚úÖ "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã" ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ "–æ–≥—É—Ä–µ—Ü"
- ‚úÖ "–ø–æ–º–∏–¥–æ—Ä—ã" vs "–ü–æ–º–∏–¥–æ—Ä—ã –æ–≥—É—Ä—Ü—ã –ø–µ—Ä–µ—Ü" ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç "–æ–≥—É—Ä–µ—Ü" + "–ø–µ—Ä–µ—Ü"
- ‚úÖ "—è–±–ª–æ–∫–∏" vs "–Ø–±–ª–æ–∫–∏ —Ç–æ–º–∞—Ç–Ω—ã–µ" ‚Üí —Ä–∞–∑–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–µ—Ç —à—Ç—Ä–∞—Ñ–∞
- ‚úÖ "–∫—É—Ä–∏—Ü–∞" vs "–ö—É—Ä–∏—Ü–∞ –≥—Ä—É–¥–∫–∞" ‚Üí –≥—Ä—É–¥–∫–∞ - —á–∞—Å—Ç—å –∫—É—Ä–∏—Ü—ã, –Ω–µ—Ç —à—Ç—Ä–∞—Ñ–∞
- ‚ö†Ô∏è "—Ç–æ–º–∞—Ç—ã" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏" ‚Üí —á–µ—Ä—Ä–∏ –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è (edge case)

‚úÖ **–¢–µ—Å—Ç 4:** –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ (4/4)
- –í—Å–µ —à—Ç—Ä–∞—Ñ—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

‚úÖ **–¢–µ—Å—Ç 5:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (4/5)
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å: "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã" ‚Üí 0.35 < 0.7 ‚úÖ
- ‚úÖ "–ø–æ–º–∏–¥–æ—Ä—ã" vs "–ü–æ–º–∏–¥–æ—Ä—ã –æ–≥—É—Ä—Ü—ã –ø–µ—Ä–µ—Ü" ‚Üí 0.55
- ‚úÖ "—è–±–ª–æ–∫–∏" vs "–Ø–±–ª–æ–∫–∏ —Ç–æ–º–∞—Ç–Ω—ã–µ" ‚Üí 1.00 (–±–µ–∑ —à—Ç—Ä–∞—Ñ–∞)
- ‚ö†Ô∏è "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∫—Ä–∞—Å–Ω—ã–µ" ‚Üí 1.00 (edge case)

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞** –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–µ–π—Å–æ–≤:

1. **–¢–æ–≤–∞—Ä—ã –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤**
   - `extra_products_penalty = 0.0` ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

2. **–¢–æ–≤–∞—Ä—ã —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
   - `has_extra = False` ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

3. **–¢–æ–≤–∞—Ä—ã —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏** (–∫—Ä–∞—Å–Ω—ã–π, —Å–≤–µ–∂–∏–π)
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ –≤ —Å–ª–æ–≤–∞—Ä—è—Ö ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

4. **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à—Ç—Ä–∞—Ñ—ã –∏ –±–æ–Ω—É—Å—ã**
   - –†–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å extra_products_penalty

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Edge Cases)

1. **"—á–µ—Ä—Ä–∏" –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ç**
   - "—á–µ—Ä—Ä–∏" –≤ search + "—Ç–æ–º–∞—Ç" –≤ found ‚Üí –ù–ï —à—Ç—Ä–∞—Ñ—É–µ—Ç—Å—è (–Ω—É–∂–Ω–∞ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞)
   - –†–µ—à–µ–Ω–∏–µ: –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π

2. **–ß–∞—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ**
   - "–≥—Ä—É–¥–∫–∞", "—Ñ–∏–ª–µ" –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ PRODUCT_PARTS, –Ω–æ –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–∞–º–∏ –ø–æ —Å–µ–±–µ - –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç—ã
   - –†–µ—à–µ–Ω–∏–µ: –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å —á–∞—Å—Ç–∏ –≤ PRODUCT_CATEGORIES

3. **–ù–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã**
   - –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –≤ —Å–ª–æ–≤–∞—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Üí —à—Ç—Ä–∞—Ñ –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
   - –†–µ—à–µ–Ω–∏–µ: —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å–ª–æ–≤–∞—Ä–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ RPA-service
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ match_score –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ —Å "‚ùå Extra products in same category"
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–ª—É—á–∞–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–æ–Ω—É—Å–æ–≤ –∏–∑-–∑–∞ extra_products
   - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞—Ä–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

3. **–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**
   - –î–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–≤—è–∑–∏ (—Ä–æ–¥–∏—Ç–µ–ª—å‚Üí–¥–æ—á–µ—Ä–Ω–∏–π vs –¥–æ—á–µ—Ä–Ω–∏–π‚Üí—Ä–æ–¥–∏—Ç–µ–ª—å)
   - –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ª–æ–≤–∞—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —á–∞—Å—Ç–µ–π/–ø–æ–¥–≤–∏–¥–æ–≤ –≤ PRODUCT_PARTS

---

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:**
   - –ö—Ä–∏—Ç–∏—á–Ω—ã–π: –ø—Ä–æ—Ü–µ–Ω—Ç—ã ‚â• 5% = -0.60
   - –í–∞–∂–Ω—ã–π: –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ = -0.45
   - –í–∞–∂–Ω—ã–π: –æ–±—Ä–∞–±–æ—Ç–∫–∞ = -0.50
   - –í–∞–∂–Ω—ã–π: 2+ –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç–∞ = -0.45
   - –°—Ä–µ–¥–Ω–∏–π: 1 –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç = -0.30

2. ‚úÖ **–ë–æ–Ω—É—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - –ü—Ä–∏ penalty >= 0.5
   - –ü—Ä–∏ has_unrequested_processing
   - –ü—Ä–∏ critical_numeric_mismatch
   - **–ü—Ä–∏ has_extra_products** (–ù–û–í–û–ï v5.6)

3. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –¢–æ–≤–∞—Ä—ã –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
   - –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à—Ç—Ä–∞—Ñ—ã –∏ –±–æ–Ω—É—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

4. ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å —Ä–µ—à–µ–Ω:**
   - "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã" ‚Üí 0.35 < 0.7 ‚úÖ

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã v5.6

```
1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
3. –ü–æ–¥—Å—á–µ—Ç —Ç–æ—á–Ω—ã—Ö/–Ω–µ—á–µ—Ç–∫–∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
4. –†–∞—Å—á–µ—Ç base_score
5. –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤:
   - Length penalty
   - First word penalty
   - Processing penalty
   - Extra products penalty (–ù–û–í–û–ï v5.6)
   - Numeric penalty
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (extra_products, numeric, processing)
7. –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º)
8. –§–∏–Ω–∞–ª—å–Ω—ã–π score = base + bonus - penalty
```

---

**–í–µ—Ä—Å–∏—è:** v5.6  
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ production  
**–û—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å:** ‚úÖ "—á–µ—Ä—Ä–∏" vs "–¢–æ–º–∞—Ç—ã —á–µ—Ä—Ä–∏ –∏ –æ–≥—É—Ä—Ü—ã" ‚Üí score < 0.7
