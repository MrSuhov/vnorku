# –ê–Ω—Ç–∏–±–æ—Ç –∑–∞—â–∏—Ç–∞: –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ–∏—Å–∫–∞–º–∏

## –î–∞—Ç–∞: 2025-10-03

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø–æ–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ RPA-—Å–µ—Ä–≤–∏—Å –Ω–∞—á–∞–ª –ª–æ–≤–∏—Ç—å antibot challenge –æ—Ç –õ–°–î. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –±–æ—Ç–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

## –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ **—É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–∏—Å–∫–∞–º–∏** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `RPA_SEARCH_DELAY_SEC`.

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. `.env` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä

```bash
# RPA Search Delays (antibot protection)
RPA_SEARCH_DELAY_SEC=1.0  # Pause between product searches to avoid antibot challenges
```

**–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `1.0` —Å–µ–∫—É–Ω–¥–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- `0.5-1.0` —Å–µ–∫ - –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –õ–°–î (Ozon, –°–∞–º–æ–∫–∞—Ç)
- `1.0-2.0` —Å–µ–∫ - –¥–ª—è –õ–°–î —Å –∂—ë—Å—Ç–∫–æ–π –∑–∞—â–∏—Ç–æ–π (–ê—à–∞–Ω, –ú–∞–≥–Ω–∏—Ç)
- `2.0-3.0` —Å–µ–∫ - –µ—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ antibot challenge
- `0.0` - –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—É–∑—ã (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)

---

### 2. `config/settings.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

```python
# RPA Search Delays (antibot protection)
rpa_search_delay_sec: float = Field(default=1.0, env="RPA_SEARCH_DELAY_SEC")
```

**–¢–∏–ø:** `float` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥—Ä–æ–±–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `0.5`, `1.5`)

---

### 3. `main.py` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—É–∑—ã –≤ 3 –º–µ—Å—Ç–∞—Ö

#### –ê. –ü–∞—É–∑–∞ –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã)

**–ë—ã–ª–æ:**
```python
await asyncio.sleep(2)  # –ñ—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω–∞—è –ø–∞—É–∑–∞
```

**–°—Ç–∞–ª–æ:**
```python
delay = settings.rpa_search_delay_sec
logger.debug(f"‚è±Ô∏è Pausing {delay}s before next variant (antibot protection)")
await asyncio.sleep(delay)
```

**–õ–æ–∫–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∞ ~1013

---

#### –ë. –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)

**–ë—ã–ª–æ:**
```python
# –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —É–¥–∞–ª–µ–Ω–∞ - –±—Ä–∞—É–∑–µ—Ä –∏ —Ç–∞–∫ –∂–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

**–°—Ç–∞–ª–æ:**
```python
# –ê–ù–¢–ò–ë–û–¢ –ó–ê–©–ò–¢–ê: –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (—É–ø—Ä–∞–≤–ª—è–µ–º–∞—è —á–µ—Ä–µ–∑ .env)
if i < len(products):
    delay = settings.rpa_search_delay_sec
    logger.info(f"‚è±Ô∏è Antibot pause: waiting {delay}s before next product...")
    await asyncio.sleep(delay)
```

**–õ–æ–∫–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∞ ~1027

---

#### –í. –ü–∞—É–∑–∞ –≤ retry –ª–æ–≥–∏–∫–µ

**–ë—ã–ª–æ:**
```python
retry_delay = 2  # —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
await asyncio.sleep(retry_delay)
```

**–°—Ç–∞–ª–æ:**
```python
retry_delay = settings.rpa_search_delay_sec  # —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –ø–∞—É–∑–∞ –∏–∑ .env
logger.debug(f"‚è±Ô∏è Retry delay: {retry_delay}s (antibot protection)")
await asyncio.sleep(retry_delay)
```

**–õ–æ–∫–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∞ ~1042, ~1063

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–º–µ—Ä: –ü–æ–∏—Å–∫ 3 —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–ª–æ–∫–æ, —Ö–ª–µ–±, –º–∞—Å–ª–æ)

**–° `RPA_SEARCH_DELAY_SEC=1.0`:**

```
üîé [1/3] Processing product: –º–æ–ª–æ–∫–æ
  ‚úÖ Found items
  ‚è±Ô∏è Antibot pause: waiting 1.0s before next product...
  
üîé [2/3] Processing product: —Ö–ª–µ–±
  ‚úÖ Found items
  ‚è±Ô∏è Antibot pause: waiting 1.0s before next product...
  
üîé [3/3] Processing product: –º–∞—Å–ª–æ
  ‚úÖ Found items
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–∞—É–∑:** 2 —Å–µ–∫—É–Ω–¥—ã (–º–µ–∂–¥—É 3 —Ç–æ–≤–∞—Ä–∞–º–∏)

---

### –ü—Ä–∏–º–µ—Ä: –¢–æ–≤–∞—Ä —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏

**–¢–æ–≤–∞—Ä:** "–ú–æ–ª–æ–∫–æ –ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ" + –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã ["–ú–æ–ª–æ–∫–æ –î–æ–º–∏–∫ –≤ –¥–µ—Ä–µ–≤–Ω–µ", "–ú–æ–ª–æ–∫–æParmalat"]

**–° `RPA_SEARCH_DELAY_SEC=1.0`:**

```
üîé [1.1] Searching: '–ú–æ–ª–æ–∫–æ –ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ'
  ‚úÖ Found 5 items
  ‚è±Ô∏è Pausing 1.0s before next variant (antibot protection)
  
üîÑ [1.2] Searching: '–ú–æ–ª–æ–∫–æ –î–æ–º–∏–∫ –≤ –¥–µ—Ä–µ–≤–Ω–µ' (alternative)
  ‚úÖ Found 3 items
  ‚è±Ô∏è Pausing 1.0s before next variant (antibot protection)
  
üîÑ [1.3] Searching: '–ú–æ–ª–æ–∫–æ Parmalat' (alternative)
  ‚úÖ Found 2 items
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–∞—É–∑:** 2 —Å–µ–∫—É–Ω–¥—ã (–º–µ–∂–¥—É 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏)

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–µ–Ω—å INFO
```
‚è±Ô∏è Antibot pause: waiting 1.0s before next product...
```

### –£—Ä–æ–≤–µ–Ω—å DEBUG
```
‚è±Ô∏è Pausing 1.0s before next variant (antibot protection)
‚è±Ô∏è Retry delay: 1.0s (antibot protection)
```

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–∞—É–∑:**
```bash
tail -f /Users/ss/GenAI/korzinka/logs/rpa-service.log | grep "Antibot pause\|Pausing\|Retry delay"
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –õ–°–î

### –ë—ã—Å—Ç—Ä—ã–µ –õ–°–î (–º—è–≥–∫–∞—è –∑–∞—â–∏—Ç–∞)
```bash
# Ozon, –°–∞–º–æ–∫–∞—Ç, –Ø–Ω–¥–µ–∫—Å.–õ–∞–≤–∫–∞
RPA_SEARCH_DELAY_SEC=0.5
```

### –°—Ä–µ–¥–Ω–∏–µ –õ–°–î (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞)
```bash
# –õ–µ–Ω—Ç–∞, –°–±–µ—Ä–º–∞—Ä–∫–µ—Ç
RPA_SEARCH_DELAY_SEC=1.0
```

### –ñ—ë—Å—Ç–∫–∏–µ –õ–°–î (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞)
```bash
# –ê—à–∞–Ω, –ú–∞–≥–Ω–∏—Ç, –ü—è—Ç—ë—Ä–æ—á–∫–∞
RPA_SEARCH_DELAY_SEC=2.0
```

### –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏
```bash
# –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –ª–æ–≤–∏—Ç–µ challenge
RPA_SEARCH_DELAY_SEC=3.0
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ 10 —Ç–æ–≤–∞—Ä–æ–≤ (–±–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤)

| –ó–∞–¥–µ—Ä–∂–∫–∞ | –í—Ä–µ–º—è –ø–∞—É–∑ | –û–±—â–µ–µ –≤—Ä–µ–º—è* |
|----------|------------|-------------|
| 0.0 —Å–µ–∫ | 0 —Å–µ–∫ | ~30 —Å–µ–∫ |
| 0.5 —Å–µ–∫ | 4.5 —Å–µ–∫ | ~34.5 —Å–µ–∫ |
| 1.0 —Å–µ–∫ | 9 —Å–µ–∫ | ~39 —Å–µ–∫ |
| 2.0 —Å–µ–∫ | 18 —Å–µ–∫ | ~48 —Å–µ–∫ |

*–û–±—â–µ–µ –≤—Ä–µ–º—è = –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü (~3 —Å–µ–∫/—Ç–æ–≤–∞—Ä) + –≤—Ä–µ–º—è –ø–∞—É–∑

---

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—É–∑ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–≤—Ä–µ–º–µ–Ω–Ω–æ** –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—É–∑—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
RPA_SEARCH_DELAY_SEC=0.0
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ antibot challenge!

---

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ **–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É `.env`:

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ .env
nano /Users/ss/GenAI/korzinka/.env

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å RPA-service
# (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hot-reload –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–∑–Ω–∞–∫–∏ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—É–∑—É):
- ‚ùå Antibot challenge –≤ –ª–æ–≥–∞—Ö
- ‚ùå –ú–Ω–æ–≥–æ failed searches
- ‚ùå CAPTCHA –∑–∞–ø—Ä–æ—Å—ã
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ –í—Å–µ –ø–æ–∏—Å–∫–∏ —É—Å–ø–µ—à–Ω—ã
- ‚úÖ –ù–µ—Ç antibot challenges
- ‚úÖ –ü—Ä–∏–µ–º–ª–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–∏–∑–Ω–∞–∫–∏ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –ø–∞—É–∑—É):
- ‚è±Ô∏è –ü–æ–∏—Å–∫ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚è±Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É
- ‚úÖ –ù–æ antibot challenges –Ω–µ—Ç

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ–º antibot challenge

**–†–µ—à–µ–Ω–∏—è:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å `RPA_SEARCH_DELAY_SEC` –¥–æ 2.0-3.0
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å User-Agent –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—É–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏)
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å proxy/VPN

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏—è:**
1. –£–º–µ–Ω—å—à–∏—Ç—å `RPA_SEARCH_DELAY_SEC` –¥–æ 0.5
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –ø–æ–∏—Å–∫–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –õ–°–î (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∞—É–∑—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ RPA-service

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `RPA_HEADLESS` - —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞
- `MAX_CONCURRENT_BROWSERS` - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
- `MAX_LSD_RETRIES` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤

---

## Changelog

**2025-10-03:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `RPA_SEARCH_DELAY_SEC`
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ø–∞—É–∑—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ø–∞—É–∑—ã –≤ retry –ª–æ–≥–∏–∫–µ
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ø–∞—É–∑—ã –º–µ–∂–¥—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
