# –ò–∑–º–µ–Ω–µ–Ω–∏—è: block_media –≤—ã–Ω–µ—Å–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥ search_config_rpa

## –î–∞—Ç–∞: 2025-10-03

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–∞—Ä–∞–º–µ—Ç—Ä `block_media` –±—ã–ª –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ –∫–æ–¥–µ (`block_media=True`), —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–æ –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –º–µ–¥–∏–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –õ–°–î:
- –î–ª—è –Ø–Ω–¥–µ–∫—Å–∞ –Ω—É–∂–Ω–æ `block_media=false` (–ø–æ–ø–∞–ø—ã —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏)
- –î–ª—è –¥—Ä—É–≥–∏—Ö –õ–°–î –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ `block_media=true` (—ç–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞)

## –†–µ—à–µ–Ω–∏–µ
–í—ã–Ω–µ—Å–ª–∏ `block_media` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∂–¥–æ–π –õ–°–î –≤ –ø–æ–ª–µ `search_config_rpa`.

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `block_media` –≤ `search_config_rpa`

**–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –õ–°–î:**

```sql
-- –Ø–Ω–¥–µ–∫—Å: –ø–æ–ø–∞–ø—ã –∫—Ä–∏—Ç–∏—á–Ω—ã, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞
UPDATE lsd_configs 
SET search_config_rpa = search_config_rpa::jsonb || '{"block_media": false}'::jsonb 
WHERE name = 'yandex';

-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –õ–°–î: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
UPDATE lsd_configs 
SET search_config_rpa = search_config_rpa::jsonb || '{"block_media": true}'::jsonb 
WHERE name != 'yandex' AND is_active = true;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
| –õ–°–î      | block_media | –ü—Ä–∏—á–∏–Ω–∞                              |
|----------|-------------|--------------------------------------|
| yandex   | `false`     | –ü–æ–ø–∞–ø—ã —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏          |
| auchan   | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| samokat  | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| ozon     | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| 5ka      | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| magnit   | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| perek    | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| lenta    | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| globus   | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| metro    | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |
| vkusvill | `true`      | –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞                     |

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `main.py`

#### 1. CDP –±—Ä–∞—É–∑–µ—Ä (Ozon, –°–∞–º–æ–∫–∞—Ç) - —Å—Ç—Ä–æ–∫–∏ 610-618

**–ë–´–õ–û:**
```python
cdp_manager = CDPCookieManager()

# block_media=True –¥–ª—è –ø–æ–∏—Å–∫–∞ - –±–ª–æ–∫–∏—Ä—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è performance
driver = cdp_manager.setup_browser_with_cdp(block_media=True)
```

**–°–¢–ê–õ–û:**
```python
cdp_manager = CDPCookieManager()

# –ß–∏—Ç–∞–µ–º block_media –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –õ–°–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞)
block_media = search_config.get('block_media', True)
logger.info(f"üìä block_media from config: {block_media}")

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä —Å CDP
driver = cdp_manager.setup_browser_with_cdp(block_media=block_media)
```

---

#### 2. SIMPLE –±—Ä–∞—É–∑–µ—Ä (–ê—à–∞–Ω, –ú–∞–≥–Ω–∏—Ç, –Ø–Ω–¥–µ–∫—Å) - —Å—Ç—Ä–æ–∫–∏ 625-638

**–ë–´–õ–û:**
```python
from simple_browser_manager import SimpleUndetectedBrowser

mobile_mode = lsd_config.rpa_config.get('mobile_mode', False) if lsd_config.rpa_config else False
logger.info(f"üì± Mobile mode: {'ENABLED' if mobile_mode else 'DISABLED'}")

driver = SimpleUndetectedBrowser.create_simple_browser(
    headless=settings.rpa_headless,
    mobile_mode=mobile_mode,
    block_media=True  # PERFORMANCE MODE –¥–ª—è –ø–æ–∏—Å–∫–∞ - –±–ª–æ–∫–∏—Ä—É–µ–º –º–µ–¥–∏–∞
)
```

**–°–¢–ê–õ–û:**
```python
from simple_browser_manager import SimpleUndetectedBrowser

mobile_mode = lsd_config.rpa_config.get('mobile_mode', False) if lsd_config.rpa_config else False
logger.info(f"üì± Mobile mode: {'ENABLED' if mobile_mode else 'DISABLED'}")

# –ß–∏—Ç–∞–µ–º block_media –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –õ–°–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞)
block_media = search_config.get('block_media', True)
logger.info(f"üìä block_media from config: {block_media}")

driver = SimpleUndetectedBrowser.create_simple_browser(
    headless=settings.rpa_headless,
    mobile_mode=mobile_mode,
    block_media=block_media
)
```

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
```python
block_media = search_config.get('block_media', True)
```

- –ï—Å–ª–∏ `block_media` **–µ—Å—Ç—å** –≤ –∫–æ–Ω—Ñ–∏–≥–µ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ï—Å–ª–∏ `block_media` **–Ω–µ—Ç** –≤ –∫–æ–Ω—Ñ–∏–≥–µ ‚Üí fallback –Ω–∞ `True` (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

### 2. –ü–µ—Ä–µ–¥–∞—á–∞ –≤ –±—Ä–∞—É–∑–µ—Ä
```python
# CDP –±—Ä–∞—É–∑–µ—Ä
driver = cdp_manager.setup_browser_with_cdp(block_media=block_media)

# SIMPLE –±—Ä–∞—É–∑–µ—Ä
driver = SimpleUndetectedBrowser.create_simple_browser(
    headless=settings.rpa_headless,
    mobile_mode=mobile_mode,
    block_media=block_media
)
```

### 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- **`block_media=true`** ‚Üí –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (*.jpg, *.png, ...), —à—Ä–∏—Ñ—Ç—ã –∏ JS —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- **`block_media=false`** ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –≤—Å–µ –º–µ–¥–∏–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
–ö–∞–∂–¥–∞—è –õ–°–î –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –Ø–Ω–¥–µ–∫—Å: `block_media=false` –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–ø–∞–ø–æ–≤
- –û—Å—Ç–∞–ª—å–Ω—ã–µ: `block_media=true` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞

### ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ –ë–î –±–µ–∑ –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞:
```sql
-- –û—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –ê—à–∞–Ω–∞
UPDATE lsd_configs 
SET search_config_rpa = search_config_rpa::jsonb || '{"block_media": false}'::jsonb 
WHERE name = 'auchan';
```

### ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
Fallback –Ω–∞ `True` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –±–µ–∑ `block_media` –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π.

### ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
```
üìä block_media from config: false
üñºÔ∏è NORMAL MODE: Images blocking DISABLED (all media allowed - QR codes, fonts, popups will work)
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. ‚úÖ **–Ø–Ω–¥–µ–∫—Å –õ–∞–≤–∫–∞** (`block_media=false`):
   - –ü–æ–ø–∞–ø —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è
   - –î–∏–∞–ø–∞–∑–æ–Ω—ã –¥–æ–ª–∂–Ω—ã –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. ‚úÖ **–ê—à–∞–Ω/–°–∞–º–æ–∫–∞—Ç** (`block_media=true`):
   - –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–±—ã—Å—Ç—Ä–µ–µ)
   - –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - UI —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (—à—Ä–∏—Ñ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è)

3. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: `üìä block_media from config: true/false`

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `main.py` - —á—Ç–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –≤ –±—Ä–∞—É–∑–µ—Ä
- ‚úÖ `simple_browser_manager.py` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ (—Å–º. IMAGES_ONLY_BLOCKING.md)
- ‚úÖ `cdp_cookie_manager.py` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Chrome prefs
- ‚úÖ `lsd_configs` (–ë–î) - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –õ–°–î

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–∏—Ç—å block_media –¥–ª—è –Ω–æ–≤–æ–π –õ–°–î
```sql
UPDATE lsd_configs 
SET search_config_rpa = search_config_rpa::jsonb || '{"block_media": true}'::jsonb 
WHERE name = '–Ω–æ–≤–∞—è_–ª—Å–¥';
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –õ–°–î
```sql
UPDATE lsd_configs 
SET search_config_rpa = search_config_rpa::jsonb || '{"block_media": false}'::jsonb 
WHERE name = 'lenta';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```sql
SELECT 
    name, 
    search_config_rpa::jsonb->>'block_media' as block_media 
FROM lsd_configs 
WHERE is_active = true 
ORDER BY name;
```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### üö® –ß—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ `block_media=true`:
- ‚úÖ –ö–∞—Ä—Ç–∏–Ω–∫–∏: `*.jpg`, `*.png`, `*.gif`, `*.webp`, `*.svg`, `*.ico`
- ‚ùå –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è: —à—Ä–∏—Ñ—Ç—ã (`*.woff`, `*.ttf`), –≤–∏–¥–µ–æ, JS, CSS

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `false`:
- –ü–æ–ø–∞–ø—ã –∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- QR-–∫–æ–¥—ã –Ω—É–∂–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°–ª–æ–∂–Ω—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π —Å—Ç–∏–ª–µ–π

### ‚ö° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `true`:
- –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö UI
- –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
- –õ–°–î –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ø–∞–ø–æ–≤

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ:
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `block_media` –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –õ–°–î –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫)
