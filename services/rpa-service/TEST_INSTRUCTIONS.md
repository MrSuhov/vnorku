# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ "–∑–∞ N –µ–¥–∏–Ω–∏—Ü–∞"

## –¶–µ–ª—å —Ç–µ—Å—Ç–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã —Å –µ–¥–∏–Ω–∏—Ü–µ–π –∏–∑–º–µ—Ä–µ–Ω–∏—è "**–∑–∞ 100 –≥**" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å—è—Ç—Å—è –∏ fprice —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

## –®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –≤ Telegram-–±–æ—Ç–µ —Å —Ç–æ–≤–∞—Ä–æ–º:
```
–ö–æ–Ω—Ñ–µ—Ç—ã –ú–∏—à–∫–∏ –≤ –ª–µ—Å—É 300–≥
```

### 2. –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ RPA

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–æ–∏—Å–∫ –≤ –ì–ª–æ–±—É—Å–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ RPA-—Å–µ—Ä–≤–∏—Å–∞:
```bash
tail -f /Users/ss/GenAI/korzinka/logs/rpa-service.log
```

**–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:**
```
‚úÖ Extracted unit text from selector: '–∑–∞ 100 –≥'
‚úÖ Parsed '–∑–∞ N unit' pattern: quantity=100.0, unit='–≥'
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
```
‚ö†Ô∏è Could not parse '–∑–∞ N unit' pattern, using quantity=1.0 with unit='–≥'
```
‚Üí –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç fallback (–ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω, –Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL:
```bash
psql postgresql://korzinka_user:korzinka_pass@localhost:5432/korzinka
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ `lsd_stocks`:**
```sql
SELECT 
    id,
    found_name,
    found_quantity,
    found_unit,
    price,
    base_quantity,
    base_unit,
    fprice,
    fprice_calculation
FROM lsd_stocks
WHERE found_name LIKE '%–ú–∏—à–∫–∏%'
  AND lsd_config_id = 13  -- –ì–ª–æ–±—É—Å
ORDER BY created_at DESC
LIMIT 5;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
found_name: –ö–æ–Ω—Ñ–µ—Ç—ã —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –ú–∏—à–∫–∏ –≤ –ª–µ—Å—É –ü–æ–±–µ–¥–∞ –≤–∫—É—Å–∞
found_quantity: 100         ‚Üê –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 100 (–Ω–µ 1!)
found_unit: –≥
price: 63
base_quantity: 0.1          ‚Üê –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.1 (100–≥ = 0.1–∫–≥)
base_unit: –∫–≥
fprice: 630                 ‚Üê –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 630 ‚ÇΩ/–∫–≥ (–Ω–µ 63000!)
fprice_calculation: fprice = price / base_quantity = 63.0 / 0.1 = 630.0 ‚ÇΩ/–∫–≥
```

---

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

### ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|----------|----------------|-------------------|
| `found_quantity` | **1** ‚ùå | **100** ‚úÖ |
| `base_quantity` | 0.001 ‚ùå | 0.1 ‚úÖ |
| `fprice` | 63000 ‚ÇΩ/–∫–≥ ‚ùå | 630 ‚ÇΩ/–∫–≥ ‚úÖ |

### ‚ö†Ô∏è –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ 2-3 –¥—Ä—É–≥–∏—Ö —Ç–æ–≤–∞—Ä–∞ –≤ –¥—Ä—É–≥–∏—Ö –õ–°–î (–Ω–µ –ì–ª–æ–±—É—Å):
- –¢–æ–≤–∞—Ä—ã —Å –æ–±—ã—á–Ω—ã–º–∏ –µ–¥–∏–Ω–∏—Ü–∞–º–∏ ("300 –≥", "1 –∫–≥")
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø–∞—Ä—Å—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–µ —Å–ª–æ–º–∞–ª–∏—Å—å)

---

## –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

### 1. –ü–∞—Ç—Ç–µ—Ä–Ω –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:** –í –ª–æ–≥–∞—Ö —Ç–æ–ª—å–∫–æ fallback, quantity=1.0

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –¢–µ–∫—Å—Ç unit_selector –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "–∑–∞ N –µ–¥–∏–Ω–∏—Ü–∞"

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ì–ª–æ–±—É—Å–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä `.//div[contains(text(), '–∑–∞')]` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–∂–Ω—ã–π —Ç–µ–∫—Å—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –ë–î –¥–ª—è –ì–ª–æ–±—É—Å–∞:
   ```sql
   SELECT search_config_rpa->'unit_selector' 
   FROM lsd_configs 
   WHERE id = 13;
   ```

### 2. fprice –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ `base_quantity` (–Ω–µ –≤ –ø–∞—Ä—Å–∏–Ω–≥–µ)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –∑–Ω–∞—á–µ–Ω–∏—è `found_quantity` –∏ `base_quantity`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `convert_to_base_unit()` –≤ `shared/utils/units.py`

### 3. –î—Ä—É–≥–∏–µ –õ–°–î —Å–ª–æ–º–∞–ª–∏—Å—å

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –†–µ–≥—Ä–µ—Å—Å–∏—è –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥—Ä—É–≥–∏—Ö –õ–°–î
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ–∫—Å—Ç –±–µ–∑ "–∑–∞")
3. –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å fprice –≤ –ë–î
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ 2-3 —Ç–æ–≤–∞—Ä–∞ –≤ –¥—Ä—É–≥–∏—Ö –õ–°–î
3. ‚úÖ –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω! üéâ
