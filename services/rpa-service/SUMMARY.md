# üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Match Score v5.2 - –ò—Ç–æ–≥–∏

## –î–∞—Ç–∞: 27 —Å–µ–Ω—Ç—è–±—Ä—è 2025

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. **–û–±–Ω–æ–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º match_score ‚Üí v5.2**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ê–ª–≥–æ—Ä–∏—Ç–º v3.0 –¥–∞–≤–∞–ª –≤—ã—Å–æ–∫–∏–π score –¥–ª—è —è–≤–Ω–æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ü—Ä–∏–º–µ—Ä: "–ª–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞—è" vs "–°–µ–ª—å–¥—å...–ª–æ—Å–æ—Å—å" ‚Üí 0.825 (–¥–æ–ª–∂–Ω–æ ~0.5)

**–†–µ—à–µ–Ω–∏–µ:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã —Å —É—á–µ—Ç–æ–º –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
- –°–º—è–≥—á–µ–Ω–∏–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–µ–∏–¥–µ–∞–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º —Å–ª–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:** ‚úÖ –í—Å–µ 5 –∫–µ–π—Å–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

| –ö–µ–π—Å | Score –±—ã–ª–æ | Score —Å—Ç–∞–ª–æ | –°—Ç–∞—Ç—É—Å |
|------|------------|-------------|--------|
| –ª–æ—Å–æ—Å—å vs —Å–µ–ª—å–¥—å | 0.825 | **0.575** | ‚úÖ ‚â§0.6 |
| —á–µ—Ä—Ä–∏ vs —Ç–æ–º–∞—Ç—ã | 1.000 | **1.000** | ‚úÖ ‚â•0.8 |
| —á–µ—Ä—Ä–∏ vs —Å–µ–º–µ–Ω–∞ | 0.000 | **0.450** | ‚úÖ ‚â§0.5 |
| —á–µ—Ä–∫–∏–∑–æ–≤–æ —Å–∞–ª—å—á–∏—á–æ–Ω | 0.900 | **0.850** | ‚úÖ 0.7-0.9 |
| –º–æ–ª–æ–∫–æ | 1.000 | **1.000** | ‚úÖ |

### 2. **–°–æ–∑–¥–∞–Ω–∞ Rematch Utility**

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ match_score –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å—è—Ö `lsd_stocks`:

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
./rematch.sh --stats

# Dry-run (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
./rematch.sh --dry-run

# –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ
./rematch.sh

# –î–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
./rematch.sh --order-id 123
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (900 –∑–∞–ø–∏—Å–µ–π):**
- 341 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (37.9%)
- 230 –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (>0.1)
- –¢–æ–ø –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: —è–≤–Ω–æ —Ä–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Ç–µ–ø–µ—Ä—å score=0.000 ‚úÖ

---

## üì¶ –§–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ
- ‚úÖ `services/rpa-service/main.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º `calculate_advanced_match_score()`
- ‚úÖ `services/rpa-service/rematch.sh` - wrapper —Å–∫—Ä–∏–ø—Ç
- ‚úÖ `services/rpa-service/rematch_stocks.py` - —É—Ç–∏–ª–∏—Ç–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `services/rpa-service/MATCH_SCORE_v52_UPDATE.md` - –¥–µ—Ç–∞–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ `services/rpa-service/REMATCH_UTILITY.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ `services/rpa-service/README_REMATCH.md` - —Å–≤–æ–¥–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `services/rpa-service/SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –¢–µ—Å—Ç—ã
- ‚úÖ `services/rpa-service/test_match_v51.py` - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ `services/rpa-service/test_match_v52_final.py` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /Users/ss/GenAI/korzinka/services/rpa-service

# 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
./rematch.sh --stats

# 3. Dry-run (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è)
./rematch.sh --dry-run

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
./rematch.sh
```

### –î–ª—è production

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow:**

```bash
# –ë—ç–∫–∞–ø –ë–î
pg_dump korzinka > backup_$(date +%Y%m%d).sql

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ
./rematch.sh --stats > stats_before.txt

# Dry-run
./rematch.sh --dry-run > rematch_preview.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TOP-10
tail -50 rematch_preview.log

# –ï—Å–ª–∏ –≤—Å–µ –û–ö - –ø—Ä–∏–º–µ–Ω–∏—Ç—å
./rematch.sh

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ
./rematch.sh --stats > stats_after.txt

# –°—Ä–∞–≤–Ω–∏—Ç—å
diff stats_before.txt stats_after.txt
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è v5.2

### 1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —à—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ**

–ï—Å–ª–∏ –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ –∑–∞–ø—Ä–æ—Å–∞ –ù–ï –≤ —Ç–æ–ø-3 –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ:
- ‚úÖ –í–°–ï —Å–ª–æ–≤–∞ –Ω–∞–π–¥–µ–Ω—ã ‚Üí —à—Ç—Ä–∞—Ñ **-0.25** (–º—è–≥–∫–∏–π)
- ‚ùå –ù–ï –≤—Å–µ –Ω–∞–π–¥–µ–Ω—ã ‚Üí —à—Ç—Ä–∞—Ñ **-0.45** (–∂–µ—Å—Ç–∫–∏–π)

**–ü—Ä–∏–º–µ—Ä:**
```
"–ª–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω–∞—è" vs "–°–µ–ª—å–¥—å...–ª–æ—Å–æ—Å—å"
–ü–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ "–ª–æ—Å–æ—Å—å" –Ω–∞ 3-–π –ø–æ–∑–∏—Ü–∏–∏ ‚Üí -0.25
base=0.75, penalty=0.25, bonus=0.075
final = 0.575 ‚úÖ
```

### 2. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã**

–ë–æ–Ω—É—Å—ã –¥–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ `penalty < 0.5`:
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: +0.15
- –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: +0.1
- –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ: +0.1 –¥–æ +0.2

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å —Ö–æ—Ä–æ—à–∏–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º –ø–æ–ª—É—á–∞—é—Ç –±–æ–Ω—É—Å—ã, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ - –Ω–µ—Ç.

### 3. **–ë–∞–ª–∞–Ω—Å —Ç–æ—á–Ω–æ—Å—Ç–∏**

- –Ø–≤–Ω–æ —Ä–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã: score < 0.3 ‚ùå
- –°–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ: score 0.3-0.6 ‚ö†Ô∏è
- –•–æ—Ä–æ—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: score 0.7-0.9 ‚úÖ
- –¢–æ—á–Ω—ã–µ: score 0.9-1.0 ‚úÖ‚úÖ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (v3.0)
```
–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: 900
–°—Ä–µ–¥–Ω–∏–π score: 0.686
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
  0.0-0.3: 230 (25.6%) - –ú–ù–û–ì–û –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å –≤—ã—Å–æ–∫–∏–º score
  0.9-1.0: 491 (54.6%)
```

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (v5.2 - –æ–∂–∏–¥–∞–µ—Ç—Å—è)
```
–û–±–Ω–æ–≤–ª–µ–Ω–æ: 341 –∑–∞–ø–∏—Å–µ–π (37.9%)
–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π: 230

–¢–æ–ø –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- "—Ö–ª–µ–±" vs "–ª–∞–≤–∞—à–∏" ‚Üí 0.650 ‚Üí 0.000 ‚úÖ
- "—Å–∞–ª—å—á–∏—á–æ–Ω" vs "—Å–∞–ª—è–º–∏" ‚Üí 0.650 ‚Üí 0.000 ‚úÖ
- "—è–±–ª–æ–∫–∏" vs "—Å–æ–∫ —è–±–ª–æ—á–Ω—ã–π" ‚Üí 0.650 ‚Üí 0.000 ‚úÖ
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
2. ‚úÖ –£—Ç–∏–ª–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞
3. ‚è≠Ô∏è **–ü–†–ò–ú–ï–ù–ò–¢–¨ rematch –Ω–∞ production** 
4. ‚è≠Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. ‚è≠Ô∏è –°–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

---

## üìö –ß–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ

- **–î–µ—Ç–∞–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:** `MATCH_SCORE_v52_UPDATE.md`
- **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É:** `REMATCH_UTILITY.md`
- **–°–≤–æ–¥–∫–∞:** `README_REMATCH.md`

---

## üí° –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### ‚ö†Ô∏è –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
1. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dry-run
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TOP-10 –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—á–Ω—ã

### ‚úÖ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
2. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞
4. –°–æ–±–∏—Ä–∞–π—Ç–µ —Ñ–∏–¥–±—ç–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üîß –û—Ç–ª–∞–¥–∫–∞
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä:
```bash
./rematch.sh --order-id 123 --dry-run --verbose
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ production
