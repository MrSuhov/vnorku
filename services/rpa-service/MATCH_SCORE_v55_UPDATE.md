# Match Score Algorithm Update v5.5

## –î–∞—Ç–∞: 4 –æ–∫—Ç—è–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º–∞ –≤ v5.4

**–ö–µ–π—Å:** "—Å–º–µ—Ç–∞–Ω–∞ 20%" vs "–°–º–µ—Ç–∞–Ω–∞ –ë—Ä–µ—Å—Ç-–õ–∏—Ç–æ–≤—Å–∫ 15% –ë–ó–ú–ñ 300–≥"
- **–¢–µ–∫—É—â–∏–π match_score v5.4:** –≤–µ—Ä–æ—è—Ç–Ω–æ –±–ª–∏–∑–∫–æ –∫ 1.0 (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- **–û–∂–∏–¥–∞–µ–º—ã–π match_score:** ‚â§ 0.5 (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º)

**–ü—Ä–∏—á–∏–Ω–∞:** –ê–ª–≥–æ—Ä–∏—Ç–º v5.4 –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª —á–∏—Å–ª–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ø—Ä–æ—Ü–µ–Ω—Ç—ã –∂–∏—Ä–Ω–æ—Å—Ç–∏, –≤–µ—Å, –æ–±—ä–µ–º) –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞.

---

## –†–µ—à–µ–Ω–∏–µ v5.5

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ `extract_numeric_parameters(text: str)` –≤ `shared/utils/text_processing.py`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç: –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∂–∏—Ä–Ω–æ—Å—Ç–∏, –≤–µ—Å (–≥/–∫–≥), –æ–±—ä–µ–º (–º–ª/–ª), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: "20%", "3.2%", "2,5%", "300–≥", "1–∫–≥", "1–ª", "500–º–ª", "10 —à—Ç"

2. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–∞ –∑–∞ —á–∏—Å–ª–æ–≤—ã–µ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ `calculate_numeric_mismatch_penalty(search_params, found_params)` –≤ `text_processing.py`
   - –ì—Ä–∞–¥—É–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `calculate_advanced_match_score()`**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   - –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–∞ –∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ–º –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ (penalty >= 0.35)

---

## –õ–æ–≥–∏–∫–∞ —à—Ç—Ä–∞—Ñ–æ–≤

### 1. –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∂–∏—Ä–Ω–æ—Å—Ç–∏ (—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)

| –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –®—Ç—Ä–∞—Ñ | –£—Ä–æ–≤–µ–Ω—å |
|------------|--------|-------|---------|
| 0% | 20% vs 20% | 0.00 | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| ‚â§ 2% | 18% vs 20% | -0.15 | –ú–∞–ª–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| 3-5% | 15% vs 20% | -0.35 | –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| > 5% | 10% vs 20% | -0.60 | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |

**–û—Å–æ–±—ã–π —Å–ª—É—á–∞–π:** –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç —É–∫–∞–∑–∞–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞–π–¥–µ–Ω–Ω–æ–º —Ç–æ–≤–∞—Ä–µ ‚Üí —à—Ç—Ä–∞—Ñ -0.10 (–ª–µ–≥–∫–∏–π)

### 2. –í–µ—Å (–º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–π, –Ω–æ –≤–∞–∂–Ω—ã–π)

| –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –®—Ç—Ä–∞—Ñ | –£—Ä–æ–≤–µ–Ω—å |
|-------------|--------|-------|---------|
| 1.0 | 300–≥ vs 300–≥ | 0.00 | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| ‚â§ 1.5 | 300–≥ vs 400–≥ | -0.10 | –ú–∞–ª–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| 1.5-2.0 | 300–≥ vs 600–≥ | -0.25 | –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| > 2.0 | 300–≥ vs 1000–≥ | -0.40 | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |

### 3. –û–±—ä–µ–º (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤–µ—Å—É)

| –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –®—Ç—Ä–∞—Ñ | –£—Ä–æ–≤–µ–Ω—å |
|-------------|--------|-------|---------|
| 1.0 | 1–ª vs 1–ª | 0.00 | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| ‚â§ 1.5 | 1–ª vs 1.5–ª | -0.10 | –ú–∞–ª–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| 1.5-2.0 | 1–ª vs 2–ª | -0.25 | –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| > 2.0 | 1–ª vs 3–ª | -0.40 | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |

### 4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫ (–¥–ª—è —è–∏—Ü, —É–ø–∞–∫–æ–≤–æ–∫)

| –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä | –®—Ç—Ä–∞—Ñ | –£—Ä–æ–≤–µ–Ω—å |
|-------------|--------|-------|---------|
| 1.0 | 10 —à—Ç vs 10 —à—Ç | 0.00 | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| ‚â§ 1.5 | 10 —à—Ç vs 12 —à—Ç | -0.08 | –ú–∞–ª–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| 1.5-2.0 | 10 —à—Ç vs 20 —à—Ç | -0.20 | –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| > 2.0 | 10 —à—Ç vs 30 —à—Ç | -0.35 | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—É–º–º–∞—Ä–Ω—ã–π —à—Ç—Ä–∞—Ñ

–®—Ç—Ä–∞—Ñ—ã —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã **–º–∞–∫—Å–∏–º—É–º 0.70**:
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã: –¥–æ -0.60
- –í–µ—Å: –¥–æ -0.40
- –û–±—ä–µ–º: –¥–æ -0.40
- –®—Ç—É–∫–∏: –¥–æ -0.35

**–û–±—â–∞—è —Ñ–æ—Ä–º—É–ª–∞:** `total_penalty = min(0.70, sum_of_all_penalties)`

---

## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤

**–í v5.4:** –ë–æ–Ω—É—Å—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `has_unrequested_processing`

**–í v5.5:** –ë–æ–Ω—É—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤ —Ç—Ä–µ—Ö —Å–ª—É—á–∞—è—Ö:
1. `penalty >= 0.5` (–º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º)
2. `has_unrequested_processing` (–Ω–µ–∑–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞)
3. **`critical_numeric_mismatch`** (numeric_penalty >= 0.35) - **–ù–û–í–û–ï**

```python
critical_numeric_mismatch = numeric_penalty >= 0.35

if penalty < 0.5 and not has_unrequested_processing and not critical_numeric_mismatch:
    # –î–∞–µ–º –±–æ–Ω—É—Å—ã
    ...
else:
    # –ë–ª–æ–∫–∏—Ä—É–µ–º –±–æ–Ω—É—Å—ã
    logger.info("Bonuses blocked due to critical numeric mismatch")
```

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–ó–∞–ø—Ä–æ—Å:** "—Å–º–µ—Ç–∞–Ω–∞ 20%"  
**–ù–∞–π–¥–µ–Ω–æ:** "–°–º–µ—Ç–∞–Ω–∞ –ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ 20% 300–≥"

```
Numeric params: search={'percentages': [20.0]}, found={'percentages': [20.0], 'weights': [300]}
Numeric penalty: 0.00 (no numeric mismatch)
üìä Score breakdown v5.5: base=1.000, bonus=0.25, penalty=0.00 (numeric=0.00), final=1.000
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–ó–∞–ø—Ä–æ—Å:** "—Å–º–µ—Ç–∞–Ω–∞ 20%"  
**–ù–∞–π–¥–µ–Ω–æ:** "–°–º–µ—Ç–∞–Ω–∞ –ë—Ä–µ—Å—Ç-–õ–∏—Ç–æ–≤—Å–∫ 15% –ë–ó–ú–ñ 300–≥"

```
Numeric params: search={'percentages': [20.0]}, found={'percentages': [15.0], 'weights': [300]}
‚ùå Numeric parameter mismatch: percentage diff=5.0% (medium) (penalty: -0.35)
‚ö†Ô∏è Full coverage bonus blocked due to critical numeric mismatch
‚ö†Ô∏è Exact ratio bonus blocked due to critical numeric mismatch
üìä Score breakdown v5.5: base=1.000, bonus=0.00, penalty=0.35 (numeric=0.35), final=0.650
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.65 (–±—ã–ª–æ –±—ã 1.00 –≤ v5.4) ‚úÖ

### –ü—Ä–∏–º–µ—Ä 3: –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–ó–∞–ø—Ä–æ—Å:** "—Å–º–µ—Ç–∞–Ω–∞ 20%"  
**–ù–∞–π–¥–µ–Ω–æ:** "–°–º–µ—Ç–∞–Ω–∞ 10%"

```
Numeric params: search={'percentages': [20.0]}, found={'percentages': [10.0]}
‚ùå Numeric parameter mismatch: percentage diff=10.0% (critical) (penalty: -0.60)
‚ö†Ô∏è Bonuses blocked due to critical numeric mismatch
üìä Score breakdown v5.5: base=1.000, bonus=0.00, penalty=0.60 (numeric=0.60), final=0.400
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.40 ‚úÖ

### –ü—Ä–∏–º–µ—Ä 4: –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤–µ—Å–∞

**–ó–∞–ø—Ä–æ—Å:** "–º–∞—Å–ª–æ 300–≥"  
**–ù–∞–π–¥–µ–Ω–æ:** "–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ 1–∫–≥"

```
Numeric params: search={'weights': [300]}, found={'weights': [1000]}
‚ùå Numeric parameter mismatch: weight ratio=3.33 (critical) (penalty: -0.40)
‚ö†Ô∏è Bonuses blocked due to critical numeric mismatch
üìä Score breakdown v5.5: base=1.000, bonus=0.00, penalty=0.40 (numeric=0.40), final=0.600
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0.60 ‚úÖ

### –ü—Ä–∏–º–µ—Ä 5: –ë–µ–∑ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–ó–∞–ø—Ä–æ—Å:** "—Ö–ª–µ–± –±–µ–ª—ã–π"  
**–ù–∞–π–¥–µ–Ω–æ:** "–•–ª–µ–± –±–µ–ª—ã–π –Ω–∞—Ä–µ–∑–Ω–æ–π"

```
Numeric params: search={}, found={}
(–ù–µ—Ç –ª–æ–≥–æ–≤ –æ numeric penalty - –µ–≥–æ –Ω–µ—Ç)
üìä Score breakdown v5.5: base=1.000, bonus=0.25, penalty=0.00 (numeric=0.00), final=1.000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1.00 (–∫–∞–∫ –≤ v5.4) ‚úÖ

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:

### –¢–µ—Å—Ç 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (8/8 ‚úÖ)
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã: "20%", "3.2%", "2,5%" 
- –í–µ—Å: "300–≥", "1–∫–≥"
- –û–±—ä–µ–º: "1–ª", "500–º–ª"
- –®—Ç—É–∫–∏: "10 —à—Ç"
- –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏: "—Å–º–µ—Ç–∞–Ω–∞ 20% 300–≥"

### –¢–µ—Å—Ç 2: –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ (8/8 ‚úÖ)
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 0.00
- –ú–∞–ª–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 0.15
- –°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 0.35
- –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 0.60
- –í–µ—Å/–æ–±—ä–µ–º/—à—Ç—É–∫–∏: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

### –¢–µ—Å—Ç 3: –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (4/4 ‚úÖ)
- –ù–µ—Ç —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –≤ –∑–∞–ø—Ä–æ—Å–µ
- –ü—Ä–æ—Ü–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –≤ –Ω–∞–π–¥–µ–Ω–Ω–æ–º
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞** –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–µ–π—Å–æ–≤:

1. **–¢–æ–≤–∞—Ä—ã –±–µ–∑ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤/–≤–µ—Å–∞** (—Ö–ª–µ–±, –æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã)
   - `numeric_penalty = 0.0` ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

2. **–¢–æ–≤–∞—Ä—ã —Å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏**
   - `numeric_penalty = 0.0` ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

3. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à—Ç—Ä–∞—Ñ—ã** (–ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ, –æ–±—Ä–∞–±–æ—Ç–∫–∞, –¥–ª–∏–Ω–∞)
   - –í—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å numeric_penalty

4. **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–æ–Ω—É—Å—ã**
   - –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ `penalty < 0.5 AND NOT critical_numeric_mismatch`

---

## –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –≤ v5.5

–¢–µ–ø–µ—Ä—å penalty –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å:
- Length penalty: -0.30
- First word penalty: -0.45
- Processing penalty: -0.50
- **Numeric penalty: -0.60** (–ù–û–í–û–ï)
- **–ò–¢–û–ì–û: –¥–æ -1.85** (–æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 0.0)

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–æ–≤—ã–µ –ª–æ–≥–∏ –≤ calculate_advanced_match_score():

```python
# –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
üî¢ Numeric params: search={'percentages': [20.0]}, found={'percentages': [15.0]}

# –ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏
‚ùå Numeric parameter mismatch: percentage diff=5.0% (medium) (penalty: -0.35)

# –ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –±–æ–Ω—É—Å–æ–≤
‚ö†Ô∏è Full coverage bonus blocked due to critical numeric mismatch
‚ö†Ô∏è Exact ratio bonus blocked due to critical numeric mismatch

# –§–∏–Ω–∞–ª—å–Ω—ã–π breakdown —Å numeric_penalty
üìä Score breakdown v5.5: base=1.000, bonus=0.00, penalty=0.35 (numeric=0.35), final=0.650
```

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **`/Users/ss/GenAI/korzinka/shared/utils/text_processing.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `extract_numeric_parameters()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_numeric_mismatch_penalty()`

2. **`/Users/ss/GenAI/korzinka/services/rpa-service/main.py`**
   - –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `calculate_advanced_match_score()`:
     - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
     - –†–∞—Å—á–µ—Ç numeric_penalty
     - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ critical_numeric_mismatch
   - –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥: "v5.4" ‚Üí "v5.5", –¥–æ–±–∞–≤–ª–µ–Ω numeric_penalty

3. **`/Users/ss/GenAI/korzinka/test_match_score_v55.py`** (–ù–û–í–´–ô)
   - –¢–µ—Å—Ç—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –¢–µ—Å—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —à—Ç—Ä–∞—Ñ–æ–≤
   - –¢–µ—Å—Ç—ã –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö**
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∂–∏—Ä–Ω–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ RPA-service
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ match_score –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ —Å "üî¢ Numeric params"
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–ª—É—á–∞–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–æ–Ω—É—Å–æ–≤ –∏–∑-–∑–∞ numeric_mismatch
   - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä–æ–≥–∏ —à—Ç—Ä–∞—Ñ–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

3. **–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (oz, lb, fl oz)
   - –£—Ç–æ—á–Ω–∏—Ç—å –ø–æ—Ä–æ–≥–∏ —à—Ç—Ä–∞—Ñ–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (–°0 vs –°1 –¥–ª—è —è–∏—Ü)

---

## –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:**
   - –ö—Ä–∏—Ç–∏—á–Ω—ã–π: –ø—Ä–æ—Ü–µ–Ω—Ç—ã ‚â• 5% = -0.60
   - –í–∞–∂–Ω—ã–π: –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ = -0.45
   - –í–∞–∂–Ω—ã–π: –æ–±—Ä–∞–±–æ—Ç–∫–∞ = -0.50
   - –°—Ä–µ–¥–Ω–∏–π: –≤–µ—Å ratio >2 = -0.40

2. ‚úÖ **–ë–æ–Ω—É—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - –ü—Ä–∏ penalty >= 0.5
   - –ü—Ä–∏ has_unrequested_processing
   - –ü—Ä–∏ critical_numeric_mismatch (‚â• 0.35)

3. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –¢–æ–≤–∞—Ä—ã –±–µ–∑ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
   - –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —à—Ç—Ä–∞—Ñ—ã –∏ –±–æ–Ω—É—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã v5.5

```
1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ù–û–í–û–ï v5.5)
4. –ü–æ–¥—Å—á–µ—Ç —Ç–æ—á–Ω—ã—Ö/–Ω–µ—á–µ—Ç–∫–∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
5. –†–∞—Å—á–µ—Ç base_score
6. –†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤:
   - Length penalty
   - First word penalty
   - Processing penalty
   - Numeric penalty (–ù–û–í–û–ï v5.5)
7. –ü—Ä–æ–≤–µ—Ä–∫–∞ critical_numeric_mismatch (–ù–û–í–û–ï v5.5)
8. –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º)
9. –§–∏–Ω–∞–ª—å–Ω—ã–π score = base + bonus - penalty
```

---

**–í–µ—Ä—Å–∏—è:** v5.5  
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ production
