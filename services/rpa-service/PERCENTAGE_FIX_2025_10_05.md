# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∂–∏—Ä–Ω–æ—Å—Ç–∏

## –ü—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–∏–º–µ—Ä:** "–°–º–µ—Ç–∞–Ω–∞ 15%, 250 –≥" –∏ "–°–º–µ—Ç–∞–Ω–∞ 20%" –ø–æ–ª—É—á–∏–ª–∏ `match_score = 1.0`

### –ê–Ω–∞–ª–∏–∑

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
   - Search: `percentages=[15.0]`, `weights=[250]`
   - Found: `percentages=[20.0]`, `weights=[]`

2. **–†–∞—Å—á–µ—Ç —à—Ç—Ä–∞—Ñ–∞ (OLD):**
   - –†–∞–∑–Ω–∏—Ü–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤: `|15.0 - 20.0| = 5.0%`
   - –ü–æ–ø–∞–¥–∞–µ—Ç –≤ —É—Å–ª–æ–≤–∏–µ `diff <= 5` ‚Üí —à—Ç—Ä–∞—Ñ **0.35**
   - –®—Ç—Ä–∞—Ñ –∑–∞ –≤–µ—Å: **0.0** (–≤ –Ω–∞–π–¥–µ–Ω–Ω–æ–º —Ç–æ–≤–∞—Ä–µ –Ω–µ—Ç –≤–µ—Å–∞)
   - **–ò—Ç–æ–≥–æ–≤—ã–π —à—Ç—Ä–∞—Ñ: 0.35**

3. **–ü—Ä–æ–±–ª–µ–º–∞:**
   - Base score –±–ª–∏–∑–æ–∫ –∫ 1.0 (–æ–±–∞ —Å–ª–æ–≤–∞ "—Å–º–µ—Ç–∞–Ω–∞" —Å–æ–≤–ø–∞–¥–∞—é—Ç)
   - –®—Ç—Ä–∞—Ñ 0.35 –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω: `1.0 - 0.35 = 0.65` ‚Üí –ø–æ—Å–ª–µ –±–æ–Ω—É—Å–æ–≤ –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ 1.0
   - **15% –∏ 20% –∂–∏—Ä–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!**

## –†–µ—à–µ–Ω–∏–µ

**–£—Å–∏–ª–∏–ª–∏ —à—Ç—Ä–∞—Ñ—ã –∑–∞ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∂–∏—Ä–Ω–æ—Å—Ç–∏:**

| –†–∞–∑–Ω–∏—Ü–∞ | –®—Ç—Ä–∞—Ñ (OLD) | –®—Ç—Ä–∞—Ñ (NEW) | –ö–∞—Ç–µ–≥–æ—Ä–∏—è |
|---------|-------------|-------------|-----------|
| 0%      | 0.0         | 0.0         | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ |
| ‚â§ 2%    | 0.15        | 0.15        | Minor (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) |
| **‚â§ 5%**    | **0.35**        | **0.50**        | **CRITICAL (—É—Å–∏–ª–µ–Ω)** |
| **> 5%**    | **0.60**        | **0.70**        | **MAXIMUM (—É—Å–∏–ª–µ–Ω)** |

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `shared/utils/text_processing.py`

**–§—É–Ω–∫—Ü–∏—è:** `calculate_numeric_mismatch_penalty()`

```python
# OLD (—Å—Ç—Ä–æ–∫–∏ 538-546)
elif diff <= 5:
    percentage_penalty = 0.35
    reasons.append(f"percentage diff={diff:.1f}% (medium)")
else:
    percentage_penalty = 0.60
    reasons.append(f"percentage diff={diff:.1f}% (critical)")

# NEW
elif diff <= 5:
    percentage_penalty = 0.50  # –£—Å–∏–ª–µ–Ω —Å 0.35
    reasons.append(f"percentage diff={diff:.1f}% (CRITICAL)")
else:
    percentage_penalty = 0.70  # –£—Å–∏–ª–µ–Ω —Å 0.60
    reasons.append(f"percentage diff={diff:.1f}% (MAXIMUM)")
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–∏–º–µ—Ä: "–°–º–µ—Ç–∞–Ω–∞ 15%, 250 –≥" vs "–°–º–µ—Ç–∞–Ω–∞ 20%"**

- –†–∞–∑–Ω–∏—Ü–∞: 5.0%
- –®—Ç—Ä–∞—Ñ (NEW): **0.50** (–±—ã–ª–æ 0.35)
- Match score: **‚â§ 0.50** (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ –±—É–¥–µ—Ç 1.0)

–¢–µ–ø–µ—Ä—å —Ç–æ–≤–∞—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ % –∂–∏—Ä–Ω–æ—Å—Ç–∏ **–Ω–µ –ø–æ–ª—É—á–∞—Ç –≤—ã—Å–æ–∫–∏–π match_score**.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
cd /Users/ss/GenAI/korzinka/services/rpa-service
python3 test_percentage_simple.py
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ Passed: 5/5
üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û!
```

## –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è

2025-10-05
